"use strict";var Engine=Matter.Engine,World=Matter.World,Bodies=Matter.Bodies,Body=Matter.Body,Composite=Matter.Composite,Composites=Matter.Composites,Common=Matter.Common,Constraint=Matter.Constraint,Events=Matter.Events,Bounds=Matter.Bounds,Vector=Matter.Vector,MouseConstraint=Matter.MouseConstraint,Mouse=Matter.Mouse,Query=Matter.Query;if(window.MatterTools)var Gui=MatterTools.Gui,Inspector=MatterTools.Inspector;var Demo={},_engine,_gui,_inspector,_sceneName,_mouseConstraint,_sceneEvents=[],_useInspector=-1!==window.location.hash.indexOf("-inspect"),_isMobile=/(ipad|iphone|ipod|android)/gi.test(navigator.userAgent);Demo.init=function(){var e=document.getElementById("cells"),n={positionIterations:6,velocityIterations:4,enableSleeping:!1};_engine=Engine.create(e,n),Engine.run(_engine),Demo.gravity()},window.addEventListener?window.addEventListener("load",Demo.init):window.attachEvent&&window.attachEvent("load",Demo.init),Demo.gravity=function(){var e=_engine.world;Demo.reset(),_engine.world.gravity.y=0,_engine.world.gravity.x=0;var n=_engine.render.options;n.wireframes=!1,n.width=2*window.innerWidth,n.height=2*window.innerHeight,n.showAngleIndicator=!1,n.background="rgba(255,255,255,0)",_engine.render.canvas.width=2*window.innerWidth,_engine.render.canvas.height=2*window.innerHeight,_engine.world.bounds.max.x=window.innerWidth,_engine.world.bounds.max.y=window.innerHeight,_engine.render.context.scale(2,2);var o=0,t=[],i=[],r=0;_sceneEvents.push(Events.on(_engine,"collisionStart",function(e){for(var n=e.pairs,o=0;o<n.length;o++){var t=n[o];1>r&&(r+=5e-4),r=parseFloat(r.toFixed(5)),t.bodyA.cancer?(t.bodyB.cancer=!0,t.bodyB.render.fillStyle=t.bodyA.render.fillStyle,t.bodyB.render.strokeStyle=t.bodyA.render.strokeStyle,document.getElementsByClassName("overlay")[0].style.opacity=r):t.bodyB.cancer&&(t.bodyA.cancer=!0,t.bodyA.render.fillStyle=t.bodyB.render.fillStyle,t.bodyA.render.strokeStyle=t.bodyB.render.strokeStyle,document.getElementsByClassName("overlay")[0].style.opacity=r)}})),_sceneEvents.push(Events.on(_engine,"beforeUpdate",function(n){var r=n.source;if(n.timestamp%10<50&&(a(r),350>o)){++o,t[o]={},t[o].opacity=0,t[o].maxOpacity=Common.random(5,15)/100,t[o].radius=0,t[o].maxRadius=Common.random(4,30);var s=Common.random(0,window.innerWidth),d=Common.random(0,window.innerHeight);i[o]={},World.add(e,Bodies.circle(s,d,t[o].maxRadius,{friction:1e-5,restitution:1e-4,density:.1,render:{fillStyle:"rgba(255,255,255,0)",strokeStyle:"rgba(255,255,255,0)",lineWidth:2}})),World.add(e,Bodies.circle(s,d,t[o].maxRadius/10,{nucleus:!0,friction:0,restitution:0,density:0,render:{fillStyle:"rgba(255,255,255,"+t[o].maxOpacity+")",strokeStyle:"rgba(255,255,255,0)",lineWidth:0}}))}}));var a=function(e){for(var n=Composite.allBodies(e.world),o=0;o<n.length;o++){var r=n[o];if("undefined"!=typeof t[o]&&(r.nucleus||(o%50==0?t[o].opacity<t[o].maxOpacity&&(t[o].opacity+=.001,r.cancer=!0,r.render.fillStyle="rgba(255,0,0,"+t[o].opacity+")",r.render.strokeStyle="rgba(255,0,0,"+(t[o].opacity+.2)+")"):t[o].opacity<t[o].maxOpacity&&(t[o].opacity+=.001,r.render.strokeStyle="rgba(255,255,255,"+t[o].opacity+")")),r.nucleus&&"undefined"!=typeof i[o]&&(r.position.x=n[o-1].position.x,r.position.y=n[o-1].position.y)),!r.isStatic&&Common.random(0,100)>33){var a=4e-5*r.mass;Body.applyForce(r,{x:0,y:0},{x:(a+Common.random(-.2,.2)*a)*Common.choose([1,-1]),y:(a+Common.random(-.2,.2)*a)*Common.choose([1,-1])})}}}},Demo.reset=function(){var e=_engine.world;World.clear(e),Engine.clear(_engine);var n=_engine.render.controller;n.clear&&n.clear(_engine.render);for(var o=0;o<_sceneEvents.length;o++)Events.off(_engine,_sceneEvents[o]);if(e.events)for(o=0;o<_sceneEvents.length;o++)Events.off(e,_sceneEvents[o]);_sceneEvents=[],Common._nextId=0,Common._seed=0,_engine.enableSleeping=!1,_engine.world.gravity.y=1,_engine.world.gravity.x=0,_engine.timing.timeScale=1;var t=_engine.render.options;t.wireframes=!0,t.hasBounds=!1,t.showDebug=!1,t.showBroadphase=!1,t.showBounds=!1,t.showVelocity=!1,t.showCollisions=!1,t.showAxes=!1,t.showPositions=!1,t.showAngleIndicator=!0,t.showIds=!1,t.showShadows=!1,t.background="#fff",_isMobile&&(t.showDebug=!0)};